<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE= edge">
    <title>SMARTLAND PROTOCOL</title>
    <script language="javascript" type="text/javascript" src="https://cdnjs.cloudfare.com/ajax/lips/jquery/3.3.1/jquery.min.js"></script>
    <script language="javascript" type="text/javascript" src="web3.min.js"></script>
    <!-- <script language="javascript" type="text/javascript" src="../javascript/smartland-web3.js"></script> -->
    <!-- <script language="javascript" type="text/javascript" src="../javascript/metamask-checker.js"></script> -->
    <script language="javascript" type="text/javascript" src="../javascript/smartland_abi.js"></script>
    <link rel="stylesheet" href="../css/style.css">
  </head>
  <body>

    <div id="title"></div>

    <div class="container">
      <div class="nav-wrapper">
        <div class="left-side">
          <div class="nav-link-wrapper">
           <a href="Index.html">HOME</a>
          </div>
          <div class="nav-link-wrapper">
           <a href="About.html">ABOUT PAGE- TEAM</a>
          </div>
       </div>
       <div class="right-side"></div>
        <div class="brand">
           <div> SMARTLAND</div>
          </div>
       </div>
     </div>
       <div class="portfolio-items-wrapper">
         <div class="portfolio-item-wrapper">
            <div class="portfolio-img-background" style="background-image:url(Images/smartland1.jpg)"></div>
            <div class="img-text-wrapper">  
               <div class="logo-wrapper">
                 <img src="Images/land 1.png"> 
               </div>
               <div class="subtitle">
                 Test for the smartland page
               </div>
            </div>
         </div>

         <div class="portfolio-item-wrapper">
          <div class="portfolio-img-background" style="background-image:url(Images/smartland2.jpg)"></div>
          <div class="img-text-wrapper">  
             <div class="logo-wrapper">
              <img src="Images/land 2.png"> 
             </div>
             <div class="subtitle">
               Test for the smartland page
             </div>
          </div>
       </div>

       <div class="portfolio-item-wrapper">
        <div class="portfolio-img-background" style="background-image:url(Images/smartland3.jpeg)"></div>
        <div class="img-text-wrapper">  
           <div class="logo-wrapper">
            <img src="Images/land 3.png"> 
           </div>
           <div class="subtitle">
             Test for the smartland page
           </div>
        </div>
     </div>

     <div class="portfolio-item-wrapper">
      <div class="portfolio-img-background" style="background-image:url(Images/survey\ plan1.jpg)"></div>
      <div class="img-text-wrapper">  
         <div class="logo-wrapper">
          <img src="Images/land 1.png"> 
         </div>
         <div class="subtitle">
           Test for the smartland page
         </div>
      </div>
   </div>

   <div class="portfolio-item-wrapper">
    <div class="portfolio-img-background" style="background-image:url(Images/survey\ plan2.jpg)"></div>
    <div class="img-text-wrapper">  
       <div class="logo-wrapper">
        <img src="Images/land 2.png">  
       </div>
       <div class="subtitle">
         Test for the smartland page
       </div>
    </div>
 </div>

 <div class="portfolio-item-wrapper">
  <div class="portfolio-img-background" style="background-image:url(Images/survey\ plan3.png)"></div>
  <div class="img-text-wrapper">  
     <div class="logo-wrapper">
      <img src="Images/land 3.png">  
     </div>
     <div class="subtitle">
       Test for the smartland page
     </div>
  </div>
</div>

       </div>
     <div class="content-wrapper">



     </div>

    </div>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>

  <script>

    // This part lets the user interface talk to the smart contract
    // Insert the smartland deployment address where the string "SMARTLAND_CONTRACT_ADDRESS" is.
    var smartLand;

    var userAccount;

    function startApp() {
      var smartLandAddress = "SMARTLAND_CONTRACT_ADDRESS";
      // The smartLandABI has been initialised in its file
      smartLand = new web3js.eth.Contract(smartLandABI, smartLandAddress);

      // Creating setInterval to check if the userAccount has changed so as to change the details on the UI
      var accountInterval = setInterval(function() {
        // Check if account has changed
        if (web3.eth.account[0] !== userAccount) {
          userAccount = web3.eth.account[0]; // for 10 default addresses "web3.eth.defaultAccount" should replace userAccount
          // Call some functions to update the UI with the new account
          getTitleByOwner(userAccount);
          .then(displayTitle);
        }
      }, 100) // This function checks the above condition every 100 miliseconds
    }

    function displayTitle(id) {
      $("#title").empty(); // Remove the details of any title in the div to update it below
      // Look up title details from the smartland contract. Returns a `title` object
      getTitleDetails(id)
      .then(function(title) {
        // Using ES6's "template literals" to inject variables into the HTML.
        // Appending each one to the #title div
        $("#title").append(`<div class="title">
          <ul>
            <li>Name: ${title.name}</li>
            <li>Address: ${title.titleAddress}</li>
          </ul>
        </div>`);
      }); 
    }

    function getTitleDetails(id) {
      return smartLand.methods.titles(id).call() // The titles(id) is a function with parameter (could be an array or struct)
    }

    function titleToOwner(id) {
      return smartLand.methods.titleToOwner(id).call()
    }

    function getTitleByOwner(owner) {
      return smartLand.methods.getTitleByOwner(owner).call()
    }

    // This is the metamask checker
    window.addEventListener('load', function() {

      // Checking if Web3 has been injected by the browser (Mist/MetaMask)
      if (typeof web3 !== 'undefined') {
          // Use Mist/MetaMask's provider;
          web3js = new Web3(web3.currentProvider);
      } else {
          // Handle the case where the user doesn't have web3. Probably
          // show them a message telling them to install Metamask in 
          // order to use our app.
          web3 = new Web3(new Web3.providers.HttpProvider("MetaMask")) 
      }

      // Now you can start your app & access web3js freely:
      startApp()
      })
  </script>
  </body>
</html>